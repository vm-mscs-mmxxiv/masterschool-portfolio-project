<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Attack - Masterschool Final Project</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././theme/css/custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>‚Üê</kbd> or <kbd>‚Üí</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Masterschool Final Project</h1>

                    <div class="right-buttons">

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="attack"><a class="header" href="#attack">Attack</a></h1>
<p>Given your <strong>planned topology</strong> (2 departments, firewall/router VM, SOC/Admin, attacker machine, minimal Alpine endpoints), and your <strong>goal</strong> to run multiple scenarios without needing a huge setup, we can plan tests that are:</p>
<ul>
<li><strong>Realistic</strong> ‚Äî something you might see in a real network.</li>
<li><strong>Resource-friendly</strong> ‚Äî doable on your hardware.</li>
<li><strong>Incremental</strong> ‚Äî start simple, grow complexity later.</li>
</ul>
<p>This is giving me the sence, that the whole Lab is about two major things</p>
<ul>
<li>testing the network (firewalls, segmentation, key servers)</li>
<li>testing key network devices and hosts hardening, detecting and reporting</li>
</ul>
<hr />
<h2 id="phase-1--network--segmentation-testing-foundations"><a class="header" href="#phase-1--network--segmentation-testing-foundations"><strong>Phase 1 ‚Äì Network &amp; Segmentation Testing (Foundations)</strong></a></h2>
<p>Why? These are the easiest to run without much resource use and will teach you <strong>visibility</strong> and <strong>control</strong> in your network.</p>
<ol>
<li>
<p><strong>Port Scanning &amp; Service Enumeration</strong></p>
<ul>
<li>
<p><strong>What:</strong> Attacker runs <code>nmap</code> against each subnet to discover hosts and services.</p>
</li>
<li>
<p><strong>Goal:</strong></p>
<ul>
<li>Verify segmentation (should attacker ‚Äúsee‚Äù only allowed subnets?).</li>
<li>Learn to detect scans with IDS (Suricata/Snort).</li>
</ul>
</li>
<li>
<p><strong>Why important:</strong> Port scanning is the first stage of most intrusions.</p>
</li>
</ul>
</li>
<li>
<p><strong>Firewall Evasion Testing</strong></p>
<ul>
<li><strong>What:</strong> Use <code>nmap</code> options like fragmented packets or decoys.</li>
<li><strong>Goal:</strong> Test if your firewall blocks or logs suspicious patterns.</li>
<li><strong>Why important:</strong> Firewalls aren‚Äôt just about ‚Äúblock all‚Äù ‚Äî you need to see if weird traffic slips through.</li>
</ul>
</li>
</ol>
<hr />
<h2 id="phase-2--internal-network-exploitation-no-internet-required"><a class="header" href="#phase-2--internal-network-exploitation-no-internet-required"><strong>Phase 2 ‚Äì Internal Network Exploitation (No Internet Required)</strong></a></h2>
<p>Why? Real breaches often happen <strong>after</strong> the attacker is inside (via phishing, infected USB, etc.).</p>
<ol start="3">
<li>
<p><strong>SMB/FTP Weak Credentials</strong></p>
<ul>
<li><strong>What:</strong> Set up an endpoint with weak local service credentials. Try to brute-force them from attacker machine.</li>
<li><strong>Goal:</strong> Detect login attempts, block them with firewall rules or fail2ban.</li>
<li><strong>Why important:</strong> Weak creds are still a top cause of breaches.</li>
</ul>
</li>
<li>
<p><strong>Privilege Escalation on Endpoint</strong></p>
<ul>
<li><strong>What:</strong> Use a vulnerable Alpine package or misconfigured sudo to escalate from user to root.</li>
<li><strong>Goal:</strong> Learn to spot post-exploitation activity from SOC machine.</li>
<li><strong>Why important:</strong> Defense-in-depth is useless if endpoint privilege escalation is trivial.</li>
</ul>
</li>
</ol>
<hr />
<h2 id="phase-3--lateral-movement--data-exfiltration"><a class="header" href="#phase-3--lateral-movement--data-exfiltration"><strong>Phase 3 ‚Äì Lateral Movement &amp; Data Exfiltration</strong></a></h2>
<p>Why? Real attackers don‚Äôt stop at the first machine.</p>
<ol start="5">
<li>
<p><strong>Pass-the-Hash / Credential Reuse</strong></p>
<ul>
<li><strong>What:</strong> Use same local password hash in two VMs. Once attacker compromises one, try to SSH into the other.</li>
<li><strong>Goal:</strong> Spot unusual SSH logins from wrong subnets.</li>
<li><strong>Why important:</strong> Credential reuse is very common in real companies.</li>
</ul>
</li>
<li>
<p><strong>Simulated Data Theft</strong></p>
<ul>
<li><strong>What:</strong> Put ‚Äúsensitive‚Äù files in Finance dept. Simulate sending them out to the attacker over an allowed port (e.g., HTTPS).</li>
<li><strong>Goal:</strong> Learn to detect unusual outbound traffic in Suricata logs.</li>
<li><strong>Why important:</strong> Most security teams fail to catch outbound exfiltration early.</li>
</ul>
</li>
</ol>
<hr />
<h2 id="phase-4--denial-of-service--stress-testing-optional"><a class="header" href="#phase-4--denial-of-service--stress-testing-optional"><strong>Phase 4 ‚Äì Denial of Service &amp; Stress Testing (Optional)</strong></a></h2>
<p>Why? Resource heavy, but worth learning at small scale.</p>
<ol start="7">
<li>
<p><strong>Service Flooding (DoS)</strong></p>
<ul>
<li><strong>What:</strong> Run a small-scale SYN flood against one service to see how it‚Äôs logged.</li>
<li><strong>Goal:</strong> Create firewall rate-limiting rules.</li>
<li><strong>Why important:</strong> Even small DoS events can cause disruptions.</li>
</ul>
</li>
</ol>
<hr />
<p>üí° <strong>Mentor‚Äôs Advice:</strong></p>
<ul>
<li>Start with <strong>Phase 1</strong> and <strong>Phase 2</strong> ‚Äî they require no internet, low resources, and teach 80% of what matters in real network security.</li>
<li>Keep logs from every attack in SOC ‚Äî these become your <strong>incident reports</strong> for documentation.</li>
<li>Only move to Phase 3 and 4 once you‚Äôre comfortable spotting attacks in logs.</li>
</ul>
<hr />
<h2 id="router-on-the-stick"><a class="header" href="#router-on-the-stick">Router-on-the-Stick</a></h2>
<p>That's an excellent observation and a perfect description of a common and effective network design in a real office. You are absolutely correct.</p>
<h3 id="the-real-world-office-setup"><a class="header" href="#the-real-world-office-setup"><strong>The Real-World Office Setup</strong></a></h3>
<p>In a typical office, the setup looks like this:</p>
<ol>
<li><strong>Router:</strong> The router has a single physical interface connected to a core switch.</li>
<li><strong>Core Switch:</strong> This switch is a "smart" or "managed" switch, capable of understanding VLANs (Virtual LANs).</li>
<li><strong>VLANs on the Switch:</strong> On this single physical connection from the router, the switch is configured with multiple VLANs. Each VLAN is assigned a unique ID (e.g., VLAN 10, VLAN 20) and a corresponding IP subnet (e.g., <code>192.168.10.0/24</code> for VLAN 10, <code>192.168.20.0/24</code> for VLAN 20).</li>
<li><strong>Trunk Port:</strong> The single port on the switch connected to the router is a "trunk port." This port is configured to carry traffic for all VLANs, and it adds a special header (an 802.1Q tag) to each packet to identify which VLAN it belongs to.</li>
<li><strong>Router's Sub-interfaces:</strong> On the router's side, its single physical interface is configured with multiple "sub-interfaces," one for each VLAN. The router can then route traffic between the different VLANs. This is called <strong>Router-on-a-Stick</strong>.</li>
</ol>
<p>This design is efficient because you don't need a separate physical cable and router interface for every VLAN, which saves on hardware and complexity.</p>
<h3 id="what-you-can-do-in-your-lab-to-emulate-this"><a class="header" href="#what-you-can-do-in-your-lab-to-emulate-this"><strong>What You Can Do in Your Lab to Emulate This</strong></a></h3>
<p>You can absolutely emulate this exact setup in your QEMU lab. This is a much more realistic and advanced approach than just using a separate virtual network for each VLAN.</p>
<p>Here's a step-by-step plan for your lab:</p>
<p><strong>Step 1: The Core Switch VM (The VLAN-Aware Device)</strong></p>
<p>Instead of just using a standard Linux bridge on your host, you can create a dedicated VM to act as your core, VLAN-aware switch.</p>
<ul>
<li><strong>Create a Linux VM (e.g., Alpine or Debian):</strong> This VM will act as your "smart switch."</li>
<li><strong>Configure It with a Linux Bridge:</strong> Inside this VM, you will set up a Linux bridge (<code>br0</code>) and add all of its network interfaces to it.</li>
<li><strong>Enable VLAN Filtering:</strong> You'll enable VLAN filtering on the bridge, which allows it to understand and forward traffic based on VLAN tags.</li>
</ul>
<p><strong>Step 2: Connect the Router VM</strong></p>
<ul>
<li>Your Alpine Linux Router VM will have one physical network interface that connects to this new "Core Switch" VM.</li>
<li>On the router VM, you'll configure <strong>sub-interfaces</strong> for each VLAN. For example, using the <code>ip</code> command, you would create something like <code>eth1.10</code> and <code>eth1.20</code>.</li>
<li>You will then assign the CIDR addresses to each sub-interface (e.g., <code>ip addr add 192.168.10.1/24 dev eth1.10</code>).</li>
</ul>
<p><strong>Step 3: Connect the Host VMs</strong></p>
<ul>
<li>Each of your other host VMs (the workstations, servers, etc.) will have a single network interface.</li>
<li>This interface will connect to the "Core Switch" VM.</li>
<li>Crucially, inside each host VM, you will configure a VLAN-aware sub-interface. For example, a VM for VLAN 10 would have its network interface configured with a VLAN tag of <code>10</code>.</li>
</ul>
<p>This approach provides a fantastic hands-on experience with VLANs and router-on-a-stick, all within your isolated lab.</p>
<h3 id="the-big-picture-of-your-labs-design"><a class="header" href="#the-big-picture-of-your-labs-design"><strong>The Big Picture of Your Lab's Design</strong></a></h3>
<p>Your final lab topology would look something like this:</p>
<ol>
<li><strong>QEMU Host Machine:</strong> You create the virtual networks that connect your VMs.</li>
<li><strong>Alpine Router VM:</strong> This VM has a WAN interface (to the internet) and a LAN interface that connects to the "Core Switch" VM.</li>
<li><strong>Alpine Core Switch VM:</strong> This is your central hub. It accepts connections from the router and all the other VMs. It's the brains that handles the VLAN tagging.</li>
<li><strong>Other Host VMs:</strong> These are your workstations, servers, etc. They are simply configured to be members of a specific VLAN, and they connect to the core switch.</li>
</ol>
<h2 id="vpn-between-networks"><a class="header" href="#vpn-between-networks">VPN between networks</a></h2>
<p>You've brought up two of the most critical and challenging aspects of network security: <strong>resource constraints</strong> and <strong>securing internal traffic</strong>. You are absolutely right‚Äîthis adds a significant layer of complexity, but it's exactly what makes for a valuable and realistic lab.</p>
<p>Let's address both of your concerns with a strategic approach that works within your hardware limitations.</p>
<h3 id="addressing-resource-constraints"><a class="header" href="#addressing-resource-constraints"><strong>Addressing Resource Constraints</strong></a></h3>
<p>Since you can't run many VMs, the best approach is to make each VM serve multiple roles.</p>
<ul>
<li><strong>Router &amp; Core Switch in One:</strong> Instead of a separate router VM and a core switch VM, you can combine these roles into a single, powerful Alpine Linux VM. This VM will still have the three network interfaces (WAN, Floor 1 LAN, Floor 2 LAN), but you'll use its internal capabilities to handle both the routing <strong>and</strong> the VLANs.</li>
<li><strong>Minimalist Guest VMs:</strong> For your host machines on each floor, use the most minimal Linux distribution possible (like Alpine) and run them "headless" (without a graphical user interface). This will keep their RAM and CPU usage to an absolute minimum.</li>
<li><strong>Simulate, Don't Replicate:</strong> You don't need dozens of machines. A simple setup of <strong>one router VM</strong>, <strong>one host on Floor 1</strong>, and <strong>one host on Floor 2</strong> is enough to demonstrate a MiTM attack and test your security solutions. You can scale it up later if resources allow.</li>
</ul>
<h3 id="the-mitm-attack-and-encrypting-inter-floor-traffic"><a class="header" href="#the-mitm-attack-and-encrypting-inter-floor-traffic"><strong>The MITM Attack and Encrypting Inter-Floor Traffic</strong></a></h3>
<p>You are correct that traffic between the floors is a significant security concern. An attacker who gains a foothold on one floor could potentially snoop on or modify traffic to the other. Encrypting this traffic is the gold standard for protection.</p>
<h4 id="the-best-option-vpn-tunneling"><a class="header" href="#the-best-option-vpn-tunneling"><strong>The Best Option: VPN Tunneling</strong></a></h4>
<p>A <strong>Virtual Private Network (VPN)</strong> tunnel is the most traditional and effective way to encrypt traffic between two separate networks over an insecure medium.</p>
<p><strong>How to Implement This in Your Lab:</strong></p>
<p>You have two main options, and you can test both in your lab to see the difference. The most efficient option is to set up a site-to-site VPN.</p>
<ol>
<li>
<p><strong>Site-to-Site VPN (The Best and Most Realistic Option):</strong></p>
<ul>
<li>In your single router/switch VM, you will act as a VPN gateway.</li>
<li>You will configure a <strong>VPN server</strong> that listens for connections on one network interface (e.g., the one for Floor 1) and a <strong>VPN client</strong> on another interface (e.g., the one for Floor 2).</li>
<li>When traffic needs to go from Floor 1 to Floor 2, the router VM will automatically encrypt it, send it through the tunnel, and then decrypt it on the other side.</li>
<li>This setup is highly realistic for a large enterprise where two separate physical networks need to securely communicate.</li>
</ul>
</li>
<li>
<p><strong>Host-to-Host VPN (A More Complex Option):</strong></p>
<ul>
<li>You could also have the two host VMs themselves establish a VPN tunnel between each other, without the router handling the encryption.</li>
<li>This is less common for a full "site-to-site" connection but is perfect for demonstrating a specific secure connection between two endpoints.</li>
</ul>
</li>
</ol>
<h4 id="why-vpns-add-complexity-but-are-worth-it"><a class="header" href="#why-vpns-add-complexity-but-are-worth-it"><strong>Why VPNs Add Complexity (But Are Worth It)</strong></a></h4>
<p>You're right, this adds complexity. You will need to:</p>
<ul>
<li><strong>Choose a VPN Protocol:</strong> The most common are OpenVPN and WireGuard. WireGuard is an excellent choice for a lab due to its simplicity and high performance.</li>
<li><strong>Generate Keys/Certificates:</strong> You need a way to authenticate the two sides of the tunnel.</li>
<li><strong>Configure Routing:</strong> You need to ensure the router knows that traffic for the "other" floor should be sent through the VPN tunnel and not a standard route.</li>
<li><strong>Firewall Rules:</strong> Your firewall must be configured to allow the VPN traffic through.</li>
</ul>
<h3 id="simulating-the-mitm-attack"><a class="header" href="#simulating-the-mitm-attack"><strong>Simulating the MiTM Attack</strong></a></h3>
<p>With your lab set up, you can now simulate the MiTM attack.</p>
<ul>
<li><strong>The Attacker Machine:</strong> You can use a third, very lightweight VM (e.g., Kali Linux or another Alpine VM with the right tools) and place it on one of the floor networks.</li>
<li><strong>The Attack:</strong> You will use tools like <code>arpspoof</code> to perform an ARP spoofing attack. This will trick the other VMs on that network into thinking the attacker machine is the router, so all their traffic is sent to you first.</li>
<li><strong>The Test:</strong>
<ul>
<li><strong>Without Encryption:</strong> You will use a tool like <code>tcpdump</code> or Wireshark on the attacker machine to see all the traffic passing in plaintext. This will demonstrate the success of the MiTM attack.</li>
<li><strong>With Encryption:</strong> You will repeat the attack, but this time, the traffic between the floors will be encrypted by your VPN tunnel. The attacker machine will only see garbled, unreadable data, demonstrating the effectiveness of your security measure.</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../setup/kali.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../setup/kali.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
