# This file is part of the custom auditd configuration generated by [Your Tool Name].
# It contains rules to monitor critical file system objects.

# ------------------------------
# User and Authentication Files
# ------------------------------
# Audit changes to the passwd file
-a always,exit -F arch={{ audit_arch }} -F path=/etc/passwd -F perm=wa -k debian_soc_passwd_change

# Audit changes to the shadow file
-a always,exit -F arch={{ audit_arch }} -F path=/etc/shadow -F perm=wa -k debian_soc_shadow_file_change

# Audit changes to the group file
-a always,exit -F arch={{ audit_arch }} -F path=/etc/group -F perm=wa -k debian_soc_auth_group

# Audit changes to the sudoers file
-a always,exit -F arch={{ audit_arch }} -F path=/etc/sudoers -F perm=wa -k debian_soc_auth_sudoers

# ------------------------------
# System Configuration Files
# ------------------------------
# Audit changes to the SSH daemon configuration
-a always,exit -F arch={{ audit_arch }} -F path=/etc/ssh/sshd_config -F perm=wa -k debian_soc_ssh_config

# Audit changes to the system crontab
-a always,exit -F arch={{ audit_arch }} -F path=/etc/crontab -F perm=wa -k debian_soc_crontab_config
-a always,exit -F arch={{ audit_arch }} -F path=/etc/cron.allow -F perm=wa -k debian_soc_cron_allow_changed
-a always,exit -F arch={{ audit_arch }} -F path=/etc/cron.d/ -F perm=wa -k debian_soc_cron_d_changed
-a always,exit -F arch={{ audit_arch }} -F path=/etc/cron.daily/ -F perm=wa -k debian_soc_cron_daily_changed
# Audit changes in anacrontab
-a always,exit -F arch={{ audit_arch }} -F path=/etc/anacrontab -F perm=wa -k debian_soc_anacrontab_config

# Audit changes to the logrotate configuration
-a always,exit -F arch={{ audit_arch }} -F path=/etc/logrotate.conf -F perm=wa -k debian_soc_logrotate_config

-a always,exit -F arch={{ audit_arch }} -F path=/etc/hosts -F perm=wa -k debian_soc_hosts_file_change
-a always,exit -F arch={{ audit_arch }} -F path=/etc/nftables.conf -F perm=wa -k debian_soc_nftables_conf_change
-a always,exit -F arch={{ audit_arch }} -F path=/etc/ -F perm=wa -k debian_soc_etc_dir_change

# Monitor execution of files in temporary directories
-a always,exit -F arch={{ audit_arch }} -F path=/tmp -F perm=x -k debian_soc_exec_tmp
-a always,exit -F arch={{ audit_arch }} -F path=/var/tmp -F perm=x -k debian_soc_exec_var_tmp
-a always,exit -F arch={{ audit_arch }} -F path=/dev/shm -F perm=x -k debian_soc_exec_shm


# ------------------------------
# Core Binary Directories
# ------------------------------
# Note: Auditing entire directories can be noisy.
# Consider a more targeted approach if you face performance issues.

# Monitor key system directories for any write/attribute changes.
-a always,exit -F arch={{ audit_arch }} -F path=/bin/ -F perm=wa -k debian_soc_binaries_bin
-a always,exit -F arch={{ audit_arch }} -F path=/sbin/ -F perm=wa -k debian_soc_binaries_sbin
-a always,exit -F arch={{ audit_arch }} -F path=/usr/bin/ -F perm=wa -k debian_soc_binaries_usrbin
-a always,exit -F arch={{ audit_arch }} -F path=/usr/sbin/ -F perm=wa -k debian_soc_binaries_usrsbin

# This will watch for use of commands to change users
-a always,exit -F arch={{ audit_arch }} -F path=/usr/sbin/useradd -F perm=x -k debian_soc_user_mgmt_useradd
-a always,exit -F arch={{ audit_arch }} -F path=/usr/sbin/userdel -F perm=x -k debian_soc_user_mgmt_userdel
-a always,exit -F arch={{ audit_arch }} -F path=/usr/sbin/usermod -F perm=x -k debian_soc_user_mgmt_usermod
-a always,exit -F arch={{ audit_arch }} -F path=/usr/sbin/groupadd -F perm=x -k debian_soc_group_mgmt_groupadd


# ------------------------------
# Process Exit Auditing
# ------------------------------
# Audit all process termination events, which can help troubleshoot unexpected application closures.
# We are monitoring the 'exit_group' syscall.
# This rule can generate a lot of events, so use with caution.
# -a always,exit -F arch=aarch64 -S exit_group -k debian_soc_terminal_exit

# A more targeted approach would be to specify the UID or the executable.
# Example: Audit if the 'bash' shell process exits unexpectedly for user 'johndoe'
-a always,exit -F arch={{ audit_arch }} -S exit_group -F exe=/usr/bin/bash -F auid=1001 -k debian_soc_bash_exit_unexpectedly

# log root commands execution
-a always,exit -F arch={{ audit_arch }} -S execve -F euid=0 -k debian_soc_suspicious_root_exec

# Logins ---------------------
# logging as su
-a always,exit -F arch={{ audit_arch }} -F path=/bin/su -F perm=x -k debian_soc_login_as_sud
-a always,exit -F arch={{ audit_arch }} -F path=/var/log/secure -F perm=wa -k debian_soc_login_log
-a always,exit -F arch={{ audit_arch }} -F path=/var/log/auth.log -F perm=wa -k debian_soc_login_log
-a always,exit -F arch={{ audit_arch }} -F path=/var/run/utmp -F perm=wa -k debian_soc_login_events
-a always,exit -F arch={{ audit_arch }} -F path=/var/log/wtmp -F perm=wa -k debian_soc_login_history

# —------------------------
# Network Activities
# —------------------------
-a always,exit -F arch={{ audit_arch }} -S socket -k debian_soc_new_network_socket
-a always,exit -F arch={{ audit_arch }} -S connect -k debian_soc_outgoing_connection

# —---------------------------------
# Persistence or Tampering
# —---------------------------------
-a always,exit -F arch={{ audit_arch }} -S init_module -S delete_module -k debian_soc_kernel_module_tamper

# mount unmount
-a always,exit -F arch={{ audit_arch }} -S mount -S umount2 -k debian_soc_mount_ops
# execution of file with setuid or setgid bit
-a always,exit -F arch={{ audit_arch }} -S setuid -S setgid -k debian_soc_sticky_bit_privilege_escalation
# watch for metadata for file changed
-a always,exit -F arch={{ audit_arch }} -S chmod,chown,fchmod,fchown,lchown -k debian_soc_file_metadata_change

